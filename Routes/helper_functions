// MODELS
var models = require('../Database/models')

var getIt = function(_user, _name, _type, response) {
	if (_name == 'all') {
		_user.fetch({ withRelated: [_type]})
		.then(function(category) {
			response.status(200)
			.json({error: false, message: "Sucessfuly read data from Database", data: category.related(_type)});
		})
		.catch(function(error){
			response.status(500)
			.json({error: true, message: "ERROR: Unable to read user's todos from Database: " + error});
		});
	} else {
		models.Category.forge({name: _name})
		.fetch()
		.then(function(category) {
			if (category) {
				category.fetch({ withRelated: [_type]})
				.then(function(category) {
					response.status(200)
					.json({error: false, message: "Sucessfuly read data from Database", data: category.related(_type)});
				})
				.catch(function(error){
					response.status(500)
					.json({error: true, message: "ERROR: Unable to read user's todos from Database: " + error});
				});
			} else {
				response.status(404)
				.json({error: true, message: "ERROR: " + _name + " not found in Database: "});
			}
		})
		.catch(function(error) {
			response.status(500)
			.json({error: true, message: "ERROR: Database query failed: " + error});
		});
	}
}

exports.getIt = getIt

var saveIt = function(_newItem, _existingItem, _type, response) {
	if(_existingItem) {
		response.status(400)
		.json({error: true, message: "ERROR: " + _type + " already exists"});
	} else {
		_newItem.save()
		.then(function() {
			response.status(201)
			.json({error: false, message: "Sucessfully created " + _newItem.get('name') + " in Database"});
		})
		.catch(function() {
			response.status(500)
			.json({error: true, message: "ERROR: Unable to create " + _newItem.get('name') + " in Database: " + err});
		});
	}
}

exports.saveIt = saveIt


var deleteIt = function(_existingItem, _name, response) {
	if (!_existingItem) {
		response.status(404)
		.json({error: true, message: "ERROR: " + _name + " not found in Database: "});
	} else {
		_existingItem.destroy()
		.then(function() {
			return true
		})
		.catch(function(error) {
			console.log(error);
			response.status(500)
			.json({error: true, message: "ERROR: Unable to delete " + _name + " from Database: " + error});
		});
	}
}

exports.deleteIt = deleteIt